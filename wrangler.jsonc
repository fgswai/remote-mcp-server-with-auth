/**
 * Production Cloudflare Workers Configuration
 * Supabase MCP Server with Multi-Provider Git Authentication
 * Optimized for Claude Code Interface
 * 
 * For more details on configuration, refer to:
 * https://developers.cloudflare.com/workers/wrangler/configuration/
 */
{
	"$schema": "node_modules/wrangler/config-schema.json",
	"name": "supabase-mcp-server",
	"main": "src/index.ts",
	"compatibility_date": "2025-03-10",
	"compatibility_flags": [
		"nodejs_compat"
	],
	"send_metrics": false,
	"migrations": [
		{
			"new_sqlite_classes": [
				"MyMCP"
			],
			"tag": "v1"
		}
	],
	"durable_objects": {
		"bindings": [
			{
				"class_name": "MyMCP",
				"name": "MCP_OBJECT"
			}
		]
	},
	"kv_namespaces": [
		{
			"binding": "OAUTH_KV",
			"id": "REPLACE_WITH_YOUR_KV_NAMESPACE_ID",
			"preview_id": "REPLACE_WITH_YOUR_PREVIEW_KV_NAMESPACE_ID"
		},
		{
			"binding": "SECURITY_LOGS_KV",
			"id": "REPLACE_WITH_YOUR_SECURITY_KV_NAMESPACE_ID",
			"preview_id": "REPLACE_WITH_YOUR_SECURITY_PREVIEW_KV_NAMESPACE_ID"
		}
	],
	"observability": {
		"enabled": true
	},
	"limits": {
		"cpu_ms": 30000
	},
	"placement": { 
		"mode": "smart" 
	},
	"dev": {
		"port": 8788,
		"local_protocol": "https"
	},
	"vars": {
		"NODE_ENV": "production",
		"CLAUDE_CODE_INTERFACE": "true",
		"ENABLE_STREAMING": "true",
		"MAX_TOOL_CALLS_PER_MINUTE": "60",
		"ENHANCED_ERROR_HANDLING": "true"
	}

	/**
	 * PRODUCTION DEPLOYMENT NOTES:
	 * 
	 * 1. KV Namespaces Setup:
	 *    Run these commands to create KV namespaces:
	 *    wrangler kv:namespace create "OAUTH_KV"
	 *    wrangler kv:namespace create "OAUTH_KV" --preview
	 *    wrangler kv:namespace create "SECURITY_LOGS_KV"
	 *    wrangler kv:namespace create "SECURITY_LOGS_KV" --preview
	 *    
	 *    Then replace the placeholder IDs above with the actual namespace IDs.
	 * 
	 * 2. Required Secrets (use wrangler secret put):
	 *    - GIT_CLIENT_ID: Your Git provider OAuth client ID
	 *    - GIT_CLIENT_SECRET: Your Git provider OAuth client secret
	 *    - GIT_PROVIDER: git provider (github, gitlab, bitbucket)
	 *    - DATABASE_URL: Your Supabase connection string
	 *    - COOKIE_ENCRYPTION_KEY: Random encryption key (openssl rand -hex 32)
	 *    - SENTRY_DSN: Optional Sentry monitoring (if using)
	 * 
	 * 3. Deployment Commands:
	 *    Development: wrangler dev
	 *    Production: wrangler deploy
	 * 
	 * 4. Custom Domain (Optional):
	 *    Configure custom domain in Cloudflare dashboard after deployment
	 * 
	 * 5. Performance Optimizations:
	 *    - Smart Placement enabled for better global performance
	 *    - CPU limit set to 30 seconds for complex operations
	 *    - Observability enabled for monitoring
	 */
}
